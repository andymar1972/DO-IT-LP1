DROP DATABASE IF EXISTS DOIT;
create database DOIT;
USE DOIT;

CREATE TABLE TB_PROGRAMA
(
	COD_PROGRAMA CHAR(3) PRIMARY KEY NOT NULL,
    NOMBRE_PROGRAMA VARCHAR(30) NOT NULL UNIQUE
);

INSERT INTO TB_PROGRAMA VALUES('P01','INGLES ADULTO');
INSERT INTO TB_PROGRAMA VALUES('P02','INGLES NIÑO');
INSERT INTO TB_PROGRAMA VALUES('P03','ROBOTICA');

CREATE TABLE TB_NIVEL
(
	COD_NIVEL CHAR(3) PRIMARY KEY NOT NULL,
    NOMBRE_NIVEL VARCHAR(30) NOT NULL UNIQUE,
    PROGRAMA_FK CHAR(3) NOT NULL,
	FOREIGN KEY (PROGRAMA_FK) REFERENCES TB_PROGRAMA (COD_PROGRAMA) 
);

INSERT INTO TB_NIVEL VALUES('N01','BASICO','P01');
INSERT INTO TB_NIVEL VALUES('N02','INTERMEDIO','P01');
INSERT INTO TB_NIVEL VALUES('N03','AVANZADO','P01');

INSERT INTO TB_NIVEL VALUES('N04','PREKIDS','P02');
INSERT INTO TB_NIVEL VALUES('N05','KIDS','P02');
INSERT INTO TB_NIVEL VALUES('N06','JUNIORS','P02');
INSERT INTO TB_NIVEL VALUES('N07','TEENS','P02');

INSERT INTO TB_NIVEL VALUES('N08','LEGO WEDO','P03');
INSERT INTO TB_NIVEL VALUES('N09','LEGO MINDSTORM EV3','P03');
INSERT INTO TB_NIVEL VALUES('N10','VEX IQ','P03');

CREATE TABLE TB_CURSO
(
	COD_CURSO CHAR(4) PRIMARY KEY NOT NULL,
    NOMBRE_CURSO VARCHAR(30) NOT NULL UNIQUE,
    NIVEL_FK CHAR(3) NOT NULL,
	FOREIGN KEY (NIVEL_FK) REFERENCES TB_NIVEL (COD_NIVEL) 
);

INSERT INTO TB_CURSO VALUES('C001','BASICO 1','N01');
INSERT INTO TB_CURSO VALUES('C002','BASICO 2','N01');

INSERT INTO TB_CURSO VALUES('C003','INTERMEDIO 1','N02');
INSERT INTO TB_CURSO VALUES('C004','INTERMEDIO 2','N02');

INSERT INTO TB_CURSO VALUES('C005','AVANZADO 1','N03');
INSERT INTO TB_CURSO VALUES('C006','AVANZADO 2','N03');

CREATE TABLE TB_APODERADO
(
	DNI_APODERADO CHAR(8) PRIMARY KEY NOT NULL,
    PRIMER_NOMBRE VARCHAR(25) NOT NULL,
    SEGUNDO_NOMBRE VARCHAR(25) NOT NULL,
    APELLIDO_PATERNO VARCHAR(25) NOT NULL,
    APELLIDO_MATERNO VARCHAR(25) NOT NULL,
    FECHA_NAC DATE NOT NULL
);

INSERT INTO TB_APODERADO VALUES('72280700','DORIAN','ALEXANDER','RODRIGUEZ','REYES','1984-01-07');

CREATE TABLE TB_ALUMNO
(
	DNI_ALUMNO CHAR(8) PRIMARY KEY NOT NULL,
    PRIMER_NOMBRE VARCHAR(25) NOT NULL,
    SEGUNDO_NOMBRE VARCHAR(25) NOT NULL,
    APELLIDO_PATERNO VARCHAR(25) NOT NULL,
    APELLIDO_MATERNO VARCHAR(25) NOT NULL,
    FECHA_NAC DATE NOT NULL
);

INSERT INTO TB_ALUMNO VALUES('72280703','ANDY','ALEXIS','MARIÑOS','RODRIGUEZ','2001-08-01');

CREATE TABLE TB_APODERA_ALUMNO
(
	DNI_APODERADO CHAR(8) NOT NULL,
    DNI_ALUMNO CHAR(8) NOT NULL,
    FOREIGN KEY (DNI_APODERADO) REFERENCES TB_APODERADO (DNI_APODERADO) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (DNI_ALUMNO) REFERENCES TB_ALUMNO (DNI_ALUMNO) ON DELETE RESTRICT ON UPDATE CASCADE,
    PRIMARY KEY(DNI_APODERADO,DNI_ALUMNO)
);

INSERT INTO TB_APODERA_ALUMNO VALUES('72280700','72280703');

CREATE TABLE TB_USUARIO
(
	COD_USUARIO CHAR(6) PRIMARY KEY NOT NULL,
    CONTRASEÑA VARCHAR(20) NOT NULL,
    PRIMER_NOMBRE VARCHAR(25) NOT NULL,
    SEGUNDO_NOMBRE VARCHAR(25) NOT NULL,
    APELLIDO_PATERNO VARCHAR(25) NOT NULL,
    APELLIDO_MATERNO VARCHAR(25) NOT NULL,
    FECHA_NAC DATE NOT NULL,
    CARGO CHAR(1) NOT NULL
);

INSERT INTO TB_USUARIO VALUES('U00001','Navidad','JULIAN','ALEX','HUAMANI','QUISPE','1900-04-06','A');
INSERT INTO TB_USUARIO VALUES('U00002','Pascua','MERCEDEZ','ELLIAM','RODRIGUEZ','SANTOS','1995-01-06','S');

CREATE TABLE TB_MATRICULA
(
	NUM_MATRICULA CHAR(6) PRIMARY KEY NOT NULL,
    FEC_MATRICULA DATE NOT NULL,
    CURSO_FK CHAR(4) NOT NULL,
	FOREIGN KEY (CURSO_FK) REFERENCES TB_CURSO (COD_CURSO),
    ALUMNO_FK CHAR(8) NOT NULL,
	FOREIGN KEY (ALUMNO_FK) REFERENCES TB_ALUMNO (DNI_ALUMNO),
    USUARIO_FK CHAR(6) NOT NULL,
	FOREIGN KEY (USUARIO_FK) REFERENCES TB_USUARIO (COD_USUARIO)
);

INSERT INTO TB_MATRICULA VALUES('M00001','2019-01-08','C001','72280703','U00002');

CREATE TABLE DETALLE_ALUMNO_MATRICULA
(
	NUM_MATRICULA VARCHAR(10) NOT NULL REFERENCES TB_MATRICULA (NUM_MATRICULA),
    DNI_ALUMNO CHAR(8) NOT NULL REFERENCES TB_ALUMNO (DNI_ALUMNO),
    FOREIGN KEY (NUM_MATRICULA) REFERENCES TB_MATRICULA (NUM_MATRICULA) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (DNI_ALUMNO) REFERENCES TB_ALUMNO (DNI_ALUMNO) ON DELETE RESTRICT ON UPDATE CASCADE,
    PRIMARY KEY(NUM_MATRICULA,DNI_ALUMNO)
);

INSERT INTO DETALLE_ALUMNO_MATRICULA VALUES('M00001','72280703');